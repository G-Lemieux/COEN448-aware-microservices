_format_version: "3.0"
_transform: true

services:
  - name: kong_order_service
    url: http://order-service:5000
    protocol: http
    routes:
      - name: order_service
        paths:
          - "/orders"
          - "/orders/(?<order_id>[\\w-]+)/(?<action>(status|details))"
        strip_path: false
        preserve_host: true
        methods:
          - GET
          - POST
          - PUT

  - name: kong_user_service_v1 
    url: http://user-service-v1:5000
    protocol: http
    routes:
      - name: user_service_v1
        paths:
          - "/users"
          - "/users/(?<user_id>[\\w-]+)"
        strip_path: false
        preserve_host: true
        methods:
          - POST
          - PUT

# plugins:
#   - name: traffic-split
#     route: user_route
#     config:
#       weighted_upstreams:
#         - upstream: user_service_v1
#           weight: ${USER_SERVICE_V1_WEIGHT}
#         - upstream: user_service_v2
#           weight: ${USER_SERVICE_V2_WEIGHT}